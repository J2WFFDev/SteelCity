Handoff: SteelCity bridge work
Date: 2025-09-03

Summary
-------
Today I reduced noise in the NDJSON logger and added a suppression rule for high-rate `bt50_buffer_status` debug lines in regular logging mode, added numeric `current_amp`-based suppression (existing), and prepared steps to validate behaviour on the Raspberry Pi.

Files changed
-------------
- `src/steelcity_impact_bridge/logs.py`
  - Added message-based suppression so `bt50_buffer_status` debug lines are not written in `regular` mode unless added to `LOG_VERBOSE_WHITELIST`.
  - Retained existing numeric `current_amp` threshold suppression via `LOG_CURRENT_AMP_THRESHOLD`.

What I did
---------
- Analyzed the Pi's most recent NDJSON and confirmed `bt50_buffer_status` was the primary source of debug noise and that many entries carried non-trivial `current_amp` values.
- Implemented suppression for `bt50_buffer_status` in `src/steelcity_impact_bridge/logs.py`.
- Created a short local analyzer to inspect NDJSON files (not committed).
- Ran remote checks (tail/grep) to inspect live logs on the Pi.

How to validate locally / on the Pi
----------------------------------
1. Copy the updated `logs.py` to the Pi:

```pwsh
scp 'C:\sandbox\TargetSensor\SteelCity\src\steelcity_impact_bridge\logs.py' jrwest@raspberrypi:~/projects/steelcity/src/steelcity_impact_bridge/logs.py
```

2. Restart the bridge with the environment variables set and tail the latest NDJSON:

```pwsh
ssh jrwest@raspberrypi 'cd ~/projects/steelcity && ./scripts/stop_bridge.sh || true; ./scripts/reset_ble.sh || true; LOG_MODE=regular LOG_CURRENT_AMP_THRESHOLD=0.001 nohup ./scripts/run_bridge.sh >/dev/null 2>&1 & echo BridgePID:$!; sleep 2; f=$(ls -t logs/bridge_*.ndjson 2>/dev/null | head -n1); echo "TAILING:$f"; tail -n 200 -F "$f"'
```

3. Perform the shot test while tail is running. Confirm:
   - No `bt50_buffer_status` debug lines appear in `regular` mode (unless whitelisted).
   - `Sensor_Initialized` events appear for BT50-origin events.

Next steps (recommended)
------------------------
- Confirm the updated `logs.py` is on the Pi and restart the bridge as described.
- If additional debug suppression is desired, add message names to `LOG_VERBOSE_WHITELIST` or raise `LOG_CURRENT_AMP_THRESHOLD`.
- Add unit tests for `NdjsonLogger` covering suppression rules.

Commit and push
---------------
I will now attempt to commit the change and push to GitHub; if the repository remote is missing or credentials are required, I'll report the exact git output and provide commands for you to run locally.

Contact
-------
If you want me to proceed and push changes, grant me permission to push (I will attempt using the repo's existing remotes); otherwise run the commands I list below locally.
